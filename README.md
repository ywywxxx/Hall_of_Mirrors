# Laser Mirrors Puzzle 🪞✨

一个基于 React + TypeScript 的激光镜子益智游戏，自动生成关卡，支持交互式解谜。

## 🎮 游戏介绍

这是一个"Hall of Mirrors / Laser Mirrors"风格的益智游戏。玩家需要在网格中放置镜子，使得从各个边界入口射入的光线经过反射后，到达边界出口时的步数与题目给出的数字一致。

## ✨ 功能特性

- **自动生成关卡**：支持 2x2 到 9x9 的网格尺寸
- **智能镜子数量**：根据网格大小使用高斯分布生成镜子数量（范围：n-1 到 ⌊n²/2⌋）
- **交互式解谜**：
  - 点击格子循环放置镜子：空 → `\` → `/` → 空
  - 悬停格子 + 按 `X` 键：标记"无镜子"（灰色叉辅助标记）
- **实时反馈**：
  - 实时显示光路路径（彩色虚线）
  - 红色数字标注：当前结果与答案不一致时显示
  - 通关检测：所有数字匹配时显示祝贺信息
- **答案提示**：点击"Show Answer"按钮查看正确答案（半透明显示）

## 🚀 快速开始

### 安装依赖

```bash
npm install
```

### 启动开发服务器

```bash
npm run dev
```

然后在浏览器中打开显示的地址（通常是 `http://localhost:5173`）

### 运行测试

```bash
npm run test
```

### 构建生产版本

```bash
npm run build
```

## 📁 项目结构

```
src/
├── engine/              # 核心游戏逻辑
│   ├── types.ts        # 类型定义（Grid, Cell, EntryPoint, TraceResult等）
│   ├── trace.ts        # 光线追踪算法（traceRay函数）
│   ├── generate.ts     # 关卡生成器（generateLevel函数）
│   ├── calculateClues.ts # 计算clues的工具函数
│   └── mirrorCount.ts  # 高斯分布生成镜子数量
├── components/         # React组件
│   └── InteractiveLevelCard.tsx  # 交互式关卡卡片组件
├── test/              # 单元测试
│   ├── trace.test.ts  # 光线追踪测试
│   └── generate.test.ts # 关卡生成测试
└── App.tsx            # 主应用组件
```

## 🎯 游戏规则

1. **目标**：在网格中放置镜子，使得从边界入口射入的光线经过反射后，到达边界出口时的步数与题目数字一致。

2. **步数计算**：
   - 光线每进入一个格子，步数 +1
   - 遇到镜子会改变方向（90°反射）
   - 当光线再次到达边界时停止计数

3. **镜子反射规则**：
   - `/` 镜子：左侧→向上，上方→向左，右侧→向下，下方→向右
   - `\` 镜子：左侧→向下，上方→向右，右侧→向上，下方→向左

4. **交互操作**：
   - **点击格子**：循环切换镜子（空 → `\` → `/` → 空）
   - **悬停 + X键**：标记/取消标记"无镜子"（灰色叉）
   - **Show Answer**：查看正确答案（半透明显示）

## 🧪 测试

项目使用 Vitest 进行单元测试，覆盖核心算法：

- `traceRay` 测试：验证光线追踪和步数计算
- `generateLevel` 测试：验证关卡生成逻辑

运行测试：
```bash
npm run test
```

## 🛠️ 技术栈

- **React 18** - UI框架
- **TypeScript** - 类型安全
- **Vite** - 构建工具
- **Vitest** - 测试框架
- **CSS-in-JS** - 样式管理

## 📝 开发说明

### 核心算法

- **光线追踪** (`src/engine/trace.ts`)：
  - 从边界入口开始追踪
  - 处理镜子反射（45度角）
  - 检测循环（防止无限循环）
  - 返回出口点和步数

- **关卡生成** (`src/engine/generate.ts`)：
  - 随机放置指定数量的镜子
  - 计算所有入口点的步数
  - 确保同一条光路的两端显示相同数字

### 镜子数量分布

对于 n×n 网格，镜子数量服从高斯分布，范围：`[n-1, ⌊n²/2⌋]`

- 2×2: 1-2 个镜子
- 3×3: 2-4 个镜子
- 4×4: 3-8 个镜子
- 5×5: 4-12 个镜子
- 6×6: 5-18 个镜子
- 7×7: 6-24 个镜子
- 8×8: 7-32 个镜子
- 9×9: 8-40 个镜子

## 🎨 UI设计

- **糖果色系**：鹅黄、浅绿、淡紫、粉蓝
- **手写体字体**：Kalam（Google Fonts）
- **45度角镜子**：棕色，带阴影效果
- **光路可视化**：彩色虚线，实时更新

## 📄 License

MIT

## 🙏 致谢

灵感来源于 Jane Street 的 "Hall of Mirrors" puzzle。
